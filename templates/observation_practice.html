<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ content.title }} - Observation Practice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/gamified.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient">
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="game-card">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2><i class="fas fa-eye me-2" style="color: var(--observation-color);"></i>{{ content.title }}</h2>
                            <p class="mb-0">Watch carefully and answer the questions!</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <a href="{{ url_for('observation_module') }}" class="btn btn-outline-primary">
                                <i class="fas fa-arrow-left me-2"></i>Back to Observation
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Video Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="module-card observation">
                    <h5><i class="fas fa-video me-2"></i>Motivational Video</h5>
                    
                    <div class="video-container text-center mb-4">
                        <div class="video-placeholder" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); 
                                                            padding: 60px 20px; 
                                                            border-radius: 15px; 
                                                            color: white;">
                            <i class="fas fa-play-circle fa-5x mb-3"></i>
                            <h4>{{ content.title }}</h4>
                            <p>üì∫ Video Link: {{ content.video_url }}</p>
                            <button class="btn btn-light btn-lg" onclick="watchVideo()">
                                <i class="fas fa-play me-2"></i>Watch Video
                            </button>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6><i class="fas fa-lightbulb me-2"></i>Observation Tips</h6>
                        <ul class="mb-0">
                            <li>üëÄ Watch the entire video carefully</li>
                            <li>üìù Pay attention to key messages and themes</li>
                            <li>üß† Think about the main points being communicated</li>
                            <li>üí° Consider how the content relates to motivation and success</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Questions Section -->
        <div class="row">
            <div class="col-12">
                <div class="game-card">
                    <h5><i class="fas fa-question-circle me-2"></i>Comprehension Questions</h5>
                    
                    <form id="observationForm" method="POST" action="{{ url_for('submit_observation') }}">
                        <input type="hidden" name="content_id" value="{{ content.id }}">
                        
                        <div class="mb-4">
                            <label for="user_answer" class="form-label">
                                <strong>Question:</strong> {{ content.questions }}
                            </label>
                            <textarea class="form-control game-input no-copy" 
                                      id="user_answer" 
                                      name="user_answer" 
                                      rows="6" 
                                      placeholder="Watch the video first, then provide your detailed answer here..."
                                      required
                                      disabled></textarea>
                            <small class="text-muted">üí° Watch the video completely before answering</small>
                        </div>
                        
                        <div class="text-center">
                            <button type="submit" class="btn btn-game-primary btn-lg" id="submitBtn" disabled>
                                <i class="fas fa-check me-2"></i>Submit Answer
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Video Watched Indicator -->
        <div class="row mt-4" id="videoWatchedIndicator" style="display: none;">
            <div class="col-12">
                <div class="game-card text-center">
                    <i class="fas fa-check-circle fa-3x mb-3" style="color: var(--observation-color);"></i>
                    <h5>Video Watched Successfully!</h5>
                    <p>Now answer the questions above to complete your observation practice.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/gamified.js') }}"></script>
    
    <script>
        let videoWatched = false;
        
        function watchVideo() {
            // Simulate video watching experience
            showFlashMessage('üé¨ Starting video... Watch carefully!', 'info');
            
            // Simulate video duration (15 seconds for demo)
            setTimeout(() => {
                videoWatched = true;
                document.getElementById('videoWatchedIndicator').style.display = 'block';
                document.getElementById('user_answer').disabled = false;
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('user_answer').focus();
                
                showFlashMessage('‚úÖ Video completed! Now answer the questions to earn points.', 'success');
            }, 15000);
        }

        // Handle form submission
        document.getElementById('observationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!videoWatched) {
                showFlashMessage('Please watch the video first!', 'warning');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Analyzing Answer...';
            submitBtn.disabled = true;
            
            const formData = new FormData(this);
            
            fetch('{{ url_for("submit_observation") }}', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                if (data.celebration) {
                    // Perfect answer celebration
                    triggerCelebration(data.points);
                    showFlashMessage(`üéâ Excellent observation! Perfect answer! Points earned: ${data.points}`, 'success');
                } else {
                    // Good attempt
                    showFlashMessage(`Good observation! Accuracy: ${data.accuracy}% | Points earned: ${data.points}`, 'info');
                }
                
                setTimeout(() => {
                    window.location.href = '{{ url_for("observation_module") }}';
                }, 3000);
            })
            .catch(error => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                showFlashMessage('Error submitting answer. Please try again.', 'error');
            });
        });
    </script>
</body>
</html>